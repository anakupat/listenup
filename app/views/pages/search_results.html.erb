<div class="container">
  <table class="table search_results">
    <% if @results["tracks"].length == 0 %>
      <div class="alert alert-danger" role="alert">
        No results found - <%= link_to "Search Again", root_path %>
      </div>
    <% else %>
      <% @results["tracks"][0,10].each_with_index do |result, index| %>
      <%= form_for Song.new(song_uri: result["href"], song_name: result["name"]),
        html: { class: "song-#{index + 1}" } do |f|  %>
    <tr>
      <td>
        <% result["artists"].each do |artist|%>
          <h4><%= artist["name"] %></h4>
        <% end %><br>
          <%= result["name"] %>
      </td>
      <td>
        <iframe src="https://embed.spotify.com/?uri=<%=result["href"] %>" width="350" height="80" frameborder="0" allowtransparency="true"></iframe>
      </td>
      <td>
        <%= f.hidden_field :song_name %>
        <%= f.hidden_field :song_uri %>
        <%= f.submit "add2", :class => "btn btn-lg btn-success add_button", name: :user_add %>
<!-- dropdown and only if user is signed in-->
      <% if user_signed_in? %>
        <div class="dropdown">
          <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">
            Add to friends playlist
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
            <% current_user.all_friendships.each do |friendship| %>
              <% if friendship.friend.username != current_user.username %>
                <li role="presentation" id="foo"><a role="menuitem" tabindex="-1" href="#" ><%= check_box_tag "user_ids[]", friendship.friend.id %> <%= friendship.friend.username %></a></li>
              <% end %>
              <% if friendship.user.username != current_user.username %>
                <li role="presentation" id="foo"><a role="menuitem" tabindex="-1" href="#" ><%= check_box_tag "user_ids[]", friendship.user.id %> <%= friendship.user.username %></a></li>
              <% end %>
            <% end %>
              <%= f.submit "add", :class => "btn btn-lg btn-success add_button", name: :friend_add %>
            </ul>
        </div>
      </td>
    </tr>
<!-- end of dropdown and only if user is signed in -->
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  </table>
</div>

<script>
  $('li').click(function(event){
      event.stopPropagation();
  });
</script>

